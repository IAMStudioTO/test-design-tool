<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body { font: 12px system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 16px; }
      button { width: 100%; padding: 10px 12px; border: 0; border-radius: 8px; cursor: pointer; margin-bottom: 8px; }
      button[disabled] { opacity: 0.5; cursor: not-allowed; }
      pre { background: #f6f6f6; padding: 10px; border-radius: 8px; overflow: auto; }
      .row { margin-top: 12px; }
      .hint { color:#666; font-size: 11px; margin: 8px 0 0; }
    </style>
  </head>
  <body>
    <h3 style="margin: 0 0 12px 0;">Test Design Tool</h3>

    <button id="create">1) Create project</button>
    <button id="open" disabled>Open editor</button>
    <button id="send" disabled>2) Send selected Frame as scene</button>
    <div class="hint">Se “Open editor” è attivo, cliccalo per aprire la pagina progetto.</div>

    <div class="row">
      <strong>Response</strong>
      <pre id="out">-</pre>
    </div>

    <script>
      const out = document.getElementById("out");
      const sendBtn = document.getElementById("send");
      const openBtn = document.getElementById("open");

      let currentProjectId = null;
      let currentEditorUrl = null;

      document.getElementById("create").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "CREATE_PROJECT" } }, "*");
      };

      openBtn.onclick = () => {
        if (!currentEditorUrl) return;
        parent.postMessage({ pluginMessage: { type: "OPEN_EDITOR", url: currentEditorUrl } }, "*");
      };

      sendBtn.onclick = () => {
        parent.postMessage(
          { pluginMessage: { type: "SEND_SCENE", projectId: currentProjectId } },
          "*"
        );
      };

      onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (!msg) return;

        if (msg.type === "PROJECT_CREATED") {
          // msg.data può essere {httpOk,status,result:{...}} (come il tuo output attuale)
          const result = msg.data && msg.data.result ? msg.data.result : msg.data;

          currentProjectId = result && result.projectId ? result.projectId : null;
          currentEditorUrl = result && result.editorUrl ? result.editorUrl : null;

          out.textContent = JSON.stringify(msg.data, null, 2);

          openBtn.disabled = !currentEditorUrl;
          sendBtn.disabled = !currentProjectId;
        }

        if (msg.type === "SCENE_SENT") {
          out.textContent = JSON.stringify(msg.data, null, 2);
        }

        if (msg.type === "ERROR") {
          out.textContent = "ERROR: " + msg.error;
        }
      };
    </script>
  </body>
</html>
